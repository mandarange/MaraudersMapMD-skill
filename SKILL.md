---
name: maraudersmapmd-skill
description: Rewrite Markdown documents to maximize readability and scan-ability and keep sharded Markdown packs in sync for fast lookup. Use this skill when the user asks to improve, rewrite, or optimize a Markdown document for readability, when asked to apply MaraudersMapMD readability formatting, or when sharded Markdown access is required.
metadata:
  version: "6.0.0"
  source: "MaraudersMapMD src/ai/aiService.ts buildReadabilityPrompt()"
  tags:
    - markdown
    - readability
    - formatting
    - maraudersmapmd
---

# MaraudersMapMD Skill

## When to Use

- User asks to improve readability, rewrite for clarity, or optimize a Markdown document for scanning
- User asks to apply MaraudersMapMD formatting or make a document AI-readable
- User provides a Markdown document and asks for editorial polish
- User asks to access content quickly via sharded Markdown or to keep shards synced with the rewritten document

## Canonical Prompt

The text below is copied verbatim from `buildReadabilityPrompt()` in `src/ai/aiService.ts` of the MaraudersMapMD extension. Apply it as-is. `${source}` stands for the user-provided Markdown.

You are an expert technical editor. Rewrite the Markdown to maximize readability and scan-ability while preserving meaning and intent.

Core requirements:
- Keep the final language the same as the original (do not translate). If mixed, use the dominant language.
- Preserve all facts, constraints, and technical details. Do not add new information.
- Keep Markdown semantics correct (headings, lists, tables, code fences, links).
- Use the project's AI hint block format where it helps: "> [AI RULE]", "> [AI DECISION]", "> [AI TODO]", "> [AI CONTEXT]".
- Prefer short paragraphs, clear headings, and consistent numbering.
- Use tables for settings, options, or structured comparisons when helpful.
- Keep code blocks and inline code exactly as-is.
- Convert ASCII art diagrams to Mermaid code blocks (see "ASCII-to-Mermaid conversion rule" below).
- Remove fluff and redundancy; keep only what's necessary.
- Output ONLY the final Markdown. No commentary.

Formatting guidance:
- Ensure headings follow a clean hierarchy.
- Convert dense prose into bullet lists where it improves readability.
- Keep a concise top summary if the document is long.

SOURCE MARKDOWN (do not omit any content):
<<<BEGIN MARKDOWN
${source}
END MARKDOWN>>>

## Procedure

Follow these five phases in order. Each phase uses a MaraudersMapMD artifact as its primary reference.

Artifact paths (generated by the extension on save):
- AI Map: `docs/MaraudersMap/<docId>/ai-map.md`
- Section Pack: `docs/MaraudersMap/<docId>/sections/*.md`
- Search Index: `docs/MaraudersMap/<docId>/index.json`
- Shard JSON: `docs/MaraudersMap/<docId>/shards.json`

### Sharded access rule (always-on)

- For fast lookup and reading, use the Section Pack (`sections/*.md`) as the primary source instead of the rewritten full document.
- Only open the rewritten file when you need full-context validation or to resolve cross-section ambiguity.
- The Section Pack must always be an exact shard-by-shard reflection of the rewritten document.

### Retrieval order for accuracy

When answering or extracting facts, use this order to minimize drift:
1. Section Pack (`sections/*.md`) for the specific section.
2. Search Index (`index.json`) for keywords/links/AI Hint Blocks validation.
3. AI Map (`ai-map.md`) for section boundaries and summaries.
4. Rewritten full document only if cross-section context is required.

### Accuracy guardrails

- Do not infer facts that are not present in the shards or index.
- If a fact appears in a shard but is missing from the index, treat the shard as the source of truth and regenerate the index.
- If shards disagree with the rewritten document, regenerate shards and index from the rewritten document immediately.

### JSON shard pack rule (Python-first)

- Generate `shards.json` from the Section Pack and Search Index to enable fast, accurate Python lookup.
- Treat `shards.json` as a read-optimized mirror. The source of truth remains the shards and rewritten document.
- Any time shards or index change, regenerate `shards.json` before answering questions.
- Use `python shards_to_json.py --doc-root docs/MaraudersMap/<docId>` to rebuild the JSON pack.
- For quick lookup, use `python shards_search.py --shards docs/MaraudersMap/<docId>/shards.json --keyword "<keyword>"`.
- For fastest relevance ranking, use `python shards_search.py --shards docs/MaraudersMap/<docId>/shards.json --query "<free text>" --top 5` (BM25).

### ASCII-to-Mermaid conversion rule

When the source Markdown contains ASCII art diagrams (box-drawing characters like `┌─┐│└─┘`, `+---+`, pipe-aligned tables used as diagrams, or any text-art layout representing structure), convert them to Mermaid code blocks during rewriting.

Conversion guidelines:
- Identify the diagram type and pick the best-fit Mermaid diagram:
  - DB schemas, ER diagrams → `erDiagram`
  - Architecture, system layout, grouping → `block-beta` or `flowchart`
  - Flows, pipelines → `flowchart LR` or `flowchart TD`
  - Sequences, timelines → `sequenceDiagram` or `timeline`
  - Class/object relationships → `classDiagram`
- Preserve every entity, relationship, label, and grouping from the original ASCII art. Do not omit items.
- Use Mermaid `subgraph` for grouped/boxed sections when the original uses visual grouping.
- Keep the Mermaid block inside a fenced code block: ` ```mermaid ... ``` `.
- If the ASCII art is ambiguous, add a one-line comment inside the Mermaid block noting the assumption.
- Do not keep the original ASCII art alongside the Mermaid block; replace it entirely.

### Mermaid validation rule (Pretty-mermaid-skills)

Mermaid syntax errors break rendering. After generating any Mermaid code block, validate and render it using [Pretty-mermaid-skills](https://github.com/imxv/Pretty-mermaid-skills).

Setup (one-time, if not already installed):
```bash
npx skills add https://github.com/imxv/pretty-mermaid-skills --skill pretty-mermaid
```

Validation flow:
1. After converting ASCII art to Mermaid, save each Mermaid block as a temporary `.mmd` file.
2. Render with Pretty-mermaid-skills to verify syntax:
   ```bash
   node scripts/render.mjs --input <file>.mmd --output <file>.svg --theme tokyo-night
   ```
3. If rendering fails, fix the Mermaid syntax and re-render until it succeeds.
4. Once validated, embed the corrected Mermaid code back into the Markdown as a fenced ` ```mermaid ``` ` block.
5. Delete the temporary `.mmd` and `.svg` files.

> [AI RULE] Never embed Mermaid code that has not passed Pretty-mermaid-skills rendering. Broken diagrams are worse than no diagrams.

### Repository safety rule

- Never modify `README.md` in this repository. All changes must be confined to skill artifacts and generated MaraudersMapMD outputs only.

### Artifact hygiene and structure rule

- Always delete outdated or superseded MaraudersMapMD artifacts (old shard packs, stale indexes, obsolete JSON packs) so the project folder never accumulates unused files.
- Enforce a single, stable folder structure: `docs/MaraudersMap/<docId>/{ai-map.md,index.json,shards.json,sections/*.md}`.
- Do not create or keep alternative artifact directories or extra copies outside the structure above.

### Final honest review rule

- Always end the workflow with a brief self-audit: re-check completed work against all rules and verify nothing is missing.
- If any gap is found, fix it before completing the task.

### Phase 1 — Baseline capture (before any rewriting)

Read the AI Map (`ai-map.md`). It contains a table of every section with line ranges, token counts, and one-line summaries. Read the Search Index (`index.json`). It lists keywords, links, and AI Hint Blocks per section. Use the Section Pack (`sections/*.md`) for quick scanning. Together these artifacts are the ground truth for what the source contains. Do not rewrite anything yet.

### Phase 2 — Create working copy

Create a `temp/` folder next to the original file. Copy the original into it as the working copy: `temp/temp_<filename>.rewritten.md`. Example: `guide.md` → `temp/temp_guide.rewritten.md`. All intermediate files go inside this `temp/` folder. All subsequent edits happen ONLY on this copy. Never modify the original.

### Phase 3 — Skeleton

Using the AI Map table as a guide, write a flat heading list in the working copy. Next to each heading note its one-line purpose. Fix heading levels so they descend without skips (single `#`, then `##`, then `###`). If the document is long, place a concise summary after the title.

### Phase 4 — Section-by-section rewrite

Open each Section Pack file (`sections/*.md`) one at a time, in order. For each section:
1. Check the Search Index entry for that section's keywords, links, and AI Hint Blocks.
2. Apply the canonical prompt rules: shorten paragraphs, convert dense prose to bullets, use tables for settings/options, keep code blocks unchanged.
3. Preserve every keyword, link, and AI Hint Block listed in the index entry.
4. Make the section self-contained. Use brief cross-references ("see Section X") instead of repeating content.

### Phase 5 — Verification and cleanup

Compare the finished output against the original Search Index:
1. Every keyword in the index must appear in the output.
2. Every AI Hint Block in the index must appear in the output.
3. Every link in the index must appear in the output.
4. Token count of the output should not significantly exceed the original (check AI Map's total).
5. Run the checklist below.

After verification passes:
1. Move `temp/temp_<filename>.rewritten.md` to the original file's directory as `<filename>.rewritten.md`.
2. Regenerate MaraudersMapMD artifacts from `<filename>.rewritten.md` so shards reflect the rewritten content.
3. Verify each `sections/*.md` shard matches its corresponding content in `<filename>.rewritten.md` (no drift).
4. Regenerate `shards.json` from the freshly generated shards and index.
5. Delete the `temp/` folder entirely.
6. Delete any stale MaraudersMapMD artifacts that do not match the rewritten document.
7. Confirm only the original source file, `<filename>.rewritten.md`, and the freshly generated MaraudersMapMD artifacts remain. No `temp/` folder or `temp_` files should exist.

### Sync rule — rewritten changes must update shards

If the rewritten document is edited at any time:
1. Re-run the MaraudersMapMD generation on `<filename>.rewritten.md`.
2. Replace the Section Pack and Search Index with the newly generated versions.
3. Regenerate `shards.json` from the updated shards and index.
4. Do not continue work until shards, index, and `shards.json` exactly match the rewritten document.

## Checklist

After rewriting, verify every item below. Each maps to a rule in the canonical prompt.

- [ ] Heading hierarchy is correct (single `#` title, levels descend without skips)
- [ ] Concise summary present at the top for long documents
- [ ] Paragraphs are short (2–4 lines); dense prose converted to bullets
- [ ] Tables used for settings, options, or structured comparisons
- [ ] No hard line breaks inside paragraphs
- [ ] No extra blank lines inside lists
- [ ] Typos fixed; product names, command names, and identifiers preserved exactly
- [ ] AI Hint Blocks (`> [AI RULE]`, `> [AI DECISION]`, `> [AI TODO]`, `> [AI CONTEXT]`) used only where the source content warrants them
- [ ] All facts, constraints, and technical details from the source are present in the output
- [ ] Code blocks and inline code unchanged (except ASCII art diagrams converted to Mermaid)
- [ ] All ASCII art diagrams converted to appropriate Mermaid code blocks with no data loss
- [ ] Every Mermaid code block validated via Pretty-mermaid-skills rendering (no syntax errors)
- [ ] Output language matches the source's dominant language
- [ ] Output is only the final Markdown — no commentary or preamble
